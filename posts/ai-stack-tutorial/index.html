<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="How to Self-Host Your Own Private AI Stack" /><meta property="og:locale" content="en" /><meta name="description" content="In this tutorial we’ll walk through my local, private, self-hosted AI stack so that you can run it too." /><meta property="og:description" content="In this tutorial we’ll walk through my local, private, self-hosted AI stack so that you can run it too." /><link rel="canonical" href="https://technotim.live/posts/ai-stack-tutorial/" /><meta property="og:url" content="https://technotim.live/posts/ai-stack-tutorial/" /><meta property="og:site_name" content="Techno Tim" /><meta property="og:image" content="https://technotim.live/assets/img/headers/ai-stack-tutorial.webp" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-08T08:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://technotim.live/assets/img/headers/ai-stack-tutorial.webp" /><meta property="twitter:title" content="How to Self-Host Your Own Private AI Stack" /><meta name="twitter:site" content="@technotimlive" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-07-15T13:11:39-05:00","datePublished":"2024-07-08T08:00:00-05:00","description":"In this tutorial we’ll walk through my local, private, self-hosted AI stack so that you can run it too.","headline":"How to Self-Host Your Own Private AI Stack","image":{"lqip":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAUACgMBEQACEQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AP5oPBP7UPhPwl8J9G01/wBln4Ca3NYadpnhJ72/m+L0L6zfaFpwkk8X66tn8UoXm8Q+Ibi4juPEa6LPoOkzbJ7TRNN0HTruWyH1H+1VsdhaKxUqWGw2HpznSo0oUpYqNStWdOji503CnjMPRqpTjRx9DFxcb0/di1bwKWb4TDYOvg6uVUMXipKpicNjMR9VrRwVT91F1cNRxOBxFfD4mpySVXEYLG4Oc6cuS0bOUvzt1+4sdX13WtWttE0vw/bapq2pajb6DojaodG0SC9vJrmLSNJOtanrOsHTNNjlWysDq2r6rqZtYYjf6lfXXm3UvNKEVKS3s3rtfXeysl6JJdkVGtNxTTSuk7JKy02V1eyP/9k=","url":"https://technotim.live/assets/img/headers/ai-stack-tutorial.webp","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://technotim.live/posts/ai-stack-tutorial/"},"url":"https://technotim.live/posts/ai-stack-tutorial/"}</script><title>How to Self-Host Your Own Private AI Stack | Techno Tim</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Techno Tim"><meta name="application-name" content="Techno Tim"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="preconnect" href="https://cdnjs.cloudflare.com" ><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://avatars.githubusercontent.com/u/1322205?s=400&u=5b4f2219006577dc0426007fe5a02391c4899677&v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Techno Tim</a></h1><p class="site-subtitle fst-italic mb-0">Engineer. Builder. Creator. | From Code to Cloud</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/shop/" class="nav-link"> <i class="fa-fw fas fa-bag-shopping"></i> <span>MERCH</span> </a><li class="nav-item"> <a href="/sponsor/" class="nav-link"> <i class="fa-fw fas fa-handshake"></i> <span>SPONSOR</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://l.technotim.live/links" aria-label="links" target="_blank" rel="noopener noreferrer" > <i class="fa-solid fa-link"></i> </a> <a href="https://twitter.com/technotimlive" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="https://l.technotim.live/github" aria-label="github-custom" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>How to Self-Host Your Own Private AI Stack</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>How to Self-Host Your Own Private AI Stack</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1720443600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 8, 2024 </time> </span> <span> Updated <time data-ts="1721067099" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 15, 2024 </time> </span><div class="mt-3 mb-3"> <a href="/assets/img/headers/ai-stack-tutorial.webp" class="popup img-link preview-img blur"><img data-src="/assets/img/headers/ai-stack-tutorial.webp" alt="Preview Image" width="1200" height="630" data-lqip="true" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAUACgMBEQACEQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AP5oPBP7UPhPwl8J9G01/wBln4Ca3NYadpnhJ72/m+L0L6zfaFpwkk8X66tn8UoXm8Q+Ibi4juPEa6LPoOkzbJ7TRNN0HTruWyH1H+1VsdhaKxUqWGw2HpznSo0oUpYqNStWdOji503CnjMPRqpTjRx9DFxcb0/di1bwKWb4TDYOvg6uVUMXipKpicNjMR9VrRwVT91F1cNRxOBxFfD4mpySVXEYLG4Oc6cuS0bOUvzt1+4sdX13WtWttE0vw/bapq2pajb6DojaodG0SC9vJrmLSNJOtanrOsHTNNjlWysDq2r6rqZtYYjf6lfXXm3UvNKEVKS3s3rtfXeysl6JJdkVGtNxTTSuk7JKy02V1eyP/9k="></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://l.technotim.live/twitter">Techno Tim</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3348 words" > <em>18 min</em> read</span></div></div></header><div class="content"><p>In this tutorial we’ll walk through my local, private, self-hosted AI stack so that you can run it too.</p><iframe class="embed-video youtube" loading="lazy" src="https://www.youtube.com/embed/yoze1IxdBdM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><p>📺 <a href="https://www.youtube.com/watch?v=yoze1IxdBdM">Watch Video</a></p><h2 id="disclosures"><span class="me-2">Disclosures</span><a href="#disclosures" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Nothing in this video was sponsored</ul><h2 id="info"><span class="me-2">Info</span><a href="#info" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you’re looking for the overview of this stack, you can out the video here <a href="/posts/private-practical-local-ai/">Self-Hosted AI That’s Actually Useful</a></p><h2 id="hardware"><span class="me-2">Hardware</span><a href="#hardware" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Machine Used for AI: <a href="https://www.youtube.com/watch?v=1lXSdg-8evA">Building My ULTIMATE, All-inOne, HomeLab Server</a></ul><h2 id="gpus"><span class="me-2">GPUs</span><a href="#gpus" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here are some cards that are good for local AI. Keep in mind that it’s always better to get a newer one for better CUDA support and more RAM. 8GB of RAM should be good for small models like the ones in this stack, however 12-24 is probably best.</p><h3 id="nvidia-rtx-3000-series"><span class="me-2">NVIDIA RTX 3000 Series</span><a href="#nvidia-rtx-3000-series" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="https://amzn.to/3WerOUI">MSI Gaming GeForce RTX 3060 12GB</a><li><a href="https://amzn.to/3WdqHV9">GIGABYTE GeForce RTX 3060 Gaming OC 12G</a><li><a href="https://amzn.to/4cTIS7Q">NVIDIA GeForce RTX 3090 Founders Edition Graphics Card (Renewed) 24GB</a><li><a href="https://amzn.to/3WdhJqV">Zotac Gaming GeForce RTX 3090 Trinity OC, 24GB</a></ul><h3 id="nvidia-rtx-4000-series"><span class="me-2">NVIDIA RTX 4000 Series</span><a href="#nvidia-rtx-4000-series" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="https://amzn.to/463LHRF">ASUS TUF Gaming GeForce RTX™ 4090 OG OC Edition Gaming Graphics Card 24GB</a><li><a href="https://amzn.to/4eVxrON">MSI Gaming GeForce RTX 4060 8GB</a><li><a href="https://amzn.to/460rqN0">ASUS Dual GeForce RTX™ 4070 White OC Edition 12GB</a></ul><h2 id="cpu"><span class="me-2">CPU</span><a href="#cpu" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You’ll want a modern CPU, if you are going desktop class here are a few I would choose</p><ul><li><a href="https://amzn.to/3XTj1Zu">Intel Core i7-12700K Gaming Desktop Processor</a><li><a href="https://amzn.to/3Lg7M5V">Intel Core i7-13700K Gaming Desktop Processor</a><li><a href="https://amzn.to/3WftehU">Intel Core i7-14700K Gaming Desktop Processor</a></ul><h2 id="storage"><span class="me-2">Storage</span><a href="#storage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For flash storage, I always go with these SSDs</p><ul><li><a href="https://amzn.to/3XTW6gA">Samsung 870 EVO SATA</a><li><a href="https://amzn.to/4cW1xA9">SAMSUNG 990 PRO SSD NVMe</a></ul><h2 id="operating-system"><span class="me-2">Operating System</span><a href="#operating-system" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I am running <a href="https://ubuntu.com/server">Ubuntu Server 24.04 LTS</a></p><h2 id="drivers"><span class="me-2">Drivers</span><a href="#drivers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Installing NVIDIA Drivers</p><p>If you need help, <a href="https://ubuntu.com/server/docs/nvidia-drivers-installation">you can check out this article</a> but here are the commands I ran.</p><p>Install the best desktop graphics card for your machine.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ubuntu-drivers <span class="nb">install</span>
</pre></table></code></div></div><p>Install NVIDIA tools</p><p>Be sure you install the version that matches your driver from above</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>nvidia-utils-535
</pre></table></code></div></div><p>Then reboot your machine</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>reboot
</pre></table></code></div></div><p>Once the machine is back up, check to be sure your drivers are functioning properly</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nvidia-smi 
</pre></table></code></div></div><h2 id="software-overview"><span class="me-2">Software Overview</span><a href="#software-overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here are the packages and repo’s we’re be using</p><ul><li><a href="https://ollama.com/">Ollama</a><li><a href="https://github.com/open-webui/open-webui">Open WebUI</a><li><a href="https://github.com/comfyanonymous/ComfyUI">ComfyUI</a><li><a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">Stable Diffusion web UI</a><li><a href="https://github.com/pluja/whishper">pluja/whishper</a><li><a href="https://huggingface.co/">HuggingFace</a><li><a href="https://www.home-assistant.io/integrations/wyoming/">Home Assistant Wyoming Protocol</a><li><a href="https://github.com/continuedev/continue">Continue Code Assistant</a><li><a href="https://github.com/searxng/searxng">searXNG</a><li><a href="https://goodsnooze.gumroad.com/l/macwhisper">MacWhisper</a></ul><h2 id="traefik"><span class="me-2">Traefik</span><a href="#traefik" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="using"><span class="me-2">Using</span><a href="#using" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>I am using Traefik as the only entry point into this stack. No ports are exposed on the host. If you don’t want to use traefik, just comment out the labels (and optionally rename the network named <code class="language-plaintext highlighter-rouge">traefik</code>). You will then need to expose ports for <code class="language-plaintext highlighter-rouge">open-webui</code>, <code class="language-plaintext highlighter-rouge">stable-diffusion-webui</code>, and <code class="language-plaintext highlighter-rouge">whisper</code> in your Docker compose file.</p><p>If you need help installing Traefik, see this post on <a href="/posts/traefik-3-docker-certificates/">installing traefik 3 on Docker</a></p><h3 id="dns"><span class="me-2">DNS</span><a href="#dns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><blockquote class="prompt-info"><p><em>Note: If using <code class="language-plaintext highlighter-rouge">traefik</code> (or any reverse proxy, remember that all of your internal DNS records will point to this machine! e.g. If the machine running this stack’s ip is <code class="language-plaintext highlighter-rouge">192.168.0.100</code> you’ll need a DNS record like <code class="language-plaintext highlighter-rouge">chat.local.example.com</code> that points to <code class="language-plaintext highlighter-rouge">192.168.0.100</code></em></p></blockquote><h3 id="auth-middleware"><span class="me-2">Auth Middleware</span><a href="#auth-middleware" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This stack contains middleware for basic auth so that the Ollama so that it is secure with a username and password. This is optional. If you don’t want to use basic auth, just remove the auth middleware labels from the <code class="language-plaintext highlighter-rouge">ollama</code> service in your compose.</p><p>Otherwise, here’s how you create the credential:</p><p>Hashing your password for <code class="language-plaintext highlighter-rouge">traefik</code> middleware</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="si">$(</span>htpasswd <span class="nt">-nB</span> ollamauser<span class="si">)</span> | <span class="nb">sed</span> <span class="nt">-e</span> s/<span class="se">\\</span><span class="nv">$/</span><span class="se">\\</span><span class="nv">$\</span><span class="se">\$</span>/g
</pre></table></code></div></div><p>You’ll then want to place this in your <code class="language-plaintext highlighter-rouge">.env</code> <a href="#variables-with-env">here</a> using the <code class="language-plaintext highlighter-rouge">OLLAMA_API_CREDENTIALS</code> variable. This is then used in the <code class="language-plaintext highlighter-rouge">ollama</code> service in your compose file.</p><h3 id="basic-auth-hash"><span class="me-2">Basic Auth Hash</span><a href="#basic-auth-hash" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If you want to create a hash value for Basic Auth (Used for Continue extension). You’ll need to use the credential from above.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'ollamauser:ollamapassword!'</span> | <span class="nb">base64</span>
</pre></table></code></div></div><h2 id="nvidia-container-toolkit"><span class="me-2">NVIDIA Container Toolkit</span><a href="#nvidia-container-toolkit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you run into issues, you can always visit the <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">NVIDIA Container Toolkit</a></p><p>Configure the production repository</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>curl <span class="nt">-fsSL</span> https://nvidia.github.io/libnvidia-container/gpgkey | <span class="nb">sudo </span>gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg <span class="se">\</span>
  <span class="o">&amp;&amp;</span> curl <span class="nt">-s</span> <span class="nt">-L</span> https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | <span class="se">\</span>
    <span class="nb">sed</span> <span class="s1">'s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g'</span> | <span class="se">\</span>
    <span class="nb">sudo tee</span> /etc/apt/sources.list.d/nvidia-container-toolkit.list
</pre></table></code></div></div><p>Update the packages list from the repository:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get update
</pre></table></code></div></div><p>Install the NVIDIA Container Toolkit packages</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> nvidia-container-toolkit
</pre></table></code></div></div><p>Configure the container runtime by using the <code class="language-plaintext highlighter-rouge">nvidia-ctk</code> command and restart docker</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>nvidia-ctk runtime configure <span class="nt">--runtime</span><span class="o">=</span>docker
<span class="nb">sudo </span>systemctl restart docker
</pre></table></code></div></div><p>This will fail if you don’t have Docker installed yet.</p><h2 id="docker"><span class="me-2">Docker</span><a href="#docker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you need to install Docker see <a href="/posts/docker-compose-install/">this post</a> on how to install <code class="language-plaintext highlighter-rouge">docker</code> and <code class="language-plaintext highlighter-rouge">docker compose</code></p><p>After installing Docker you will need to reconfigure the runtime</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>nvidia-ctk runtime configure <span class="nt">--runtime</span><span class="o">=</span>docker
<span class="nb">sudo </span>systemctl restart docker
</pre></table></code></div></div><h2 id="testing"><span class="me-2">Testing</span><a href="#testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This will test to make sure that the NVIDIA container toolkit can access the NVidia driver.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>docker run <span class="nt">--rm</span> <span class="nt">--runtime</span><span class="o">=</span>nvidia <span class="nt">--gpus</span> all ubuntu nvidia-smi
</pre></table></code></div></div><p>You should see the same output as running <code class="language-plaintext highlighter-rouge">nvidia-smi</code> without Docker.</p><h2 id="folder-structure"><span class="me-2">Folder Structure</span><a href="#folder-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Stacks live in <code class="language-plaintext highlighter-rouge">/opt/stacks</code></p><p>Here is the folder structure. Most subfolders are created when binding volumes.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>├── ai-stack
│   ├── .env
│   ├── compose.yaml
│   ├── ollama
│   ├── open-webui
│   ├── searxng
│   ├── stable-diffusion-webui-docker
│   └── whisper
├── home-assistant-stack
│   ├── compose.yaml
│   ├── faster-whisper
│   ├── home-assistant
│   └── wyoming-piper
</pre></table></code></div></div><h2 id="folder-permissions"><span class="me-2">Folder Permissions</span><a href="#folder-permissions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you run into any folder permission errors while running any of this, you can simple change the owner to yourself using the command. Please replace the user and group with your own user and group.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo chown </span>serveradmin:serveradmin <span class="nt">-R</span> /opt/stacks
</pre></table></code></div></div><h2 id="variables-with-env"><span class="me-2">Variables with .env</span><a href="#variables-with-env" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>My <code class="language-plaintext highlighter-rouge">ai-stack</code> <code class="language-plaintext highlighter-rouge">.env</code>is pretty minimal</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">OLLAMA_API_CREDENTIALS</span><span class="o">=</span>
<span class="nv">DB_USER</span><span class="o">=</span>
<span class="nv">DB_PASS</span><span class="o">=</span>
<span class="nv">WHISHPER_HOST</span><span class="o">=</span>https://whisper.local.example.com
<span class="nv">WHISPER_MODELS</span><span class="o">=</span>tiny,small
<span class="nv">PUID</span><span class="o">=</span>
<span class="nv">PGID</span><span class="o">=</span>
</pre></table></code></div></div><h2 id="ai-stack-docker-compose"><span class="me-2">AI Stack (Docker Compose)</span><a href="#ai-stack-docker-compose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here is my <code class="language-plaintext highlighter-rouge">compose.yaml</code></p><p>You’ll want to create this in the root of your stack folder (see folder structure above)</p><p>The command I use to start, build, and remove orphans is:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker compose up <span class="nt">-d</span> <span class="nt">--build</span> <span class="nt">--force-recreate</span> <span class="nt">--remove-orphans</span>
</pre></table></code></div></div><p>otherwise you can use</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker compose up <span class="nt">-d</span> <span class="nt">--build</span>
</pre></table></code></div></div><p>There are additional steps you’ll need to do before starting this stack. Please continue on to the end.</p><p>Here are 2 Docker compose files that you can use on your system.</p><h3 id="my-docker-compose-stack"><span class="me-2">My Docker Compose Stack</span><a href="#my-docker-compose-stack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The stack is the one I use in the video as well as at home. If you want to use the general stack without traefik and macvlan, see <a href="#general-docker-compose-stack">the general Docker compose stack</a></p><p>Before running this, you will need to create the network for Docker to use.</p><p>This might already exist if you are using traefik. If so skip this step.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker network create traefik
</pre></table></code></div></div><p>This will create the <code class="language-plaintext highlighter-rouge">macvlan</code> network. Adjust accordingly.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>docker network create <span class="nt">-d</span> macvlan <span class="se">\</span>
<span class="nt">--subnet</span><span class="o">=</span>192.168.20.0/24 <span class="se">\</span>
<span class="nt">--gateway</span><span class="o">=</span>192.168.20.1 <span class="se">\</span>
<span class="nt">-o</span> <span class="nv">parent</span><span class="o">=</span>eth1 <span class="se">\</span>
iot_macvlan
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">compose.yaml</code></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
</pre><td class="rouge-code"><pre><span class="na">services</span><span class="pi">:</span>

<span class="c1"># Ollama</span>

  <span class="na">ollama</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ollama/ollama:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">ollama</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">OLLAMA_KEEP_ALIVE=24h</span>
      <span class="pi">-</span> <span class="s">ENABLE_IMAGE_GENERATION=True</span>
      <span class="pi">-</span> <span class="s">COMFYUI_BASE_URL=http://stable-diffusion-webui:7860</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./ollama:/root/.ollama</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.ollama.rule=Host(`ollama.local.example.com`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.ollama.entrypoints=https"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.ollama.tls=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.ollama.tls.certresolver=cloudflare"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.ollama.middlewares=default-headers@file"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.ollama.middlewares=ollama-auth"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.ollama.loadbalancer.server.port=11434"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.ollama.middlewares=auth"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.middlewares.auth.basicauth.users=${OLLAMA_API_CREDENTIALS}"</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
              <span class="na">count</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>

<span class="c1"># open web ui</span>
  <span class="na">open-webui</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/open-webui/open-webui:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">open-webui</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">OLLAMA_BASE_URL=http://ollama:11434'</span>
      <span class="pi">-</span> <span class="s">ENABLE_RAG_WEB_SEARCH=True</span>
      <span class="pi">-</span> <span class="s">RAG_WEB_SEARCH_ENGINE=searxng</span>
      <span class="pi">-</span> <span class="s">RAG_WEB_SEARCH_RESULT_COUNT=3</span>
      <span class="pi">-</span> <span class="s">RAG_WEB_SEARCH_CONCURRENT_REQUESTS=10</span>
      <span class="pi">-</span> <span class="s">SEARXNG_QUERY_URL=http://searxng:8080/search?q=&lt;query&gt;</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./open-webui:/app/backend/data</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.open-webui.rule=Host(`chat.local.example.com`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.open-webui.entrypoints=https"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.open-webui.tls=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.open-webui.tls.certresolver=cloudflare"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.open-webui.middlewares=default-headers@file"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.open-webui.loadbalancer.server.port=8080"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ollama</span>
    <span class="na">extra_hosts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">host.docker.internal:host-gateway</span>

  <span class="na">searxng</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">searxng/searxng:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">searxng</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./searxng:/etc/searxng</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ollama</span>
      <span class="pi">-</span> <span class="s">open-webui</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

<span class="c1"># stable diffusion</span>

  <span class="na">stable-diffusion-download</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./stable-diffusion-webui-docker/services/download/</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">comfy-download</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./stable-diffusion-webui-docker/data:/data</span>

  <span class="na">stable-diffusion-webui</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./stable-diffusion-webui-docker/services/comfy/</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">comfy-ui</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">CLI_ARGS=</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./stable-diffusion-webui-docker/data:/data</span>
      <span class="pi">-</span> <span class="s">./stable-diffusion-webui-docker/output:/output</span>

    <span class="na">stop_signal</span><span class="pi">:</span> <span class="s">SIGKILL</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
                <span class="na">device_ids</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">0'</span><span class="pi">]</span>
                <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">compute</span><span class="pi">,</span> <span class="nv">utility</span><span class="pi">]</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.stable-diffusion.rule=Host(`stable-diffusion.local.example.com`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.stable-diffusion.entrypoints=https"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.stable-diffusion.tls=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.stable-diffusion.tls.certresolver=cloudflare"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.stable-diffusion.loadbalancer.server.port=7860"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.stable-diffusion.middlewares=default-headers@file"</span>

<span class="c1"># whisper</span>
  <span class="na">mongo</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mongo</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./whisper/db_data:/data/db</span>
      <span class="pi">-</span> <span class="s">./whisper/db_data/logs/:/var/log/mongodb/</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">MONGO_INITDB_ROOT_USERNAME=${DB_USER:-whishper}</span>
      <span class="pi">-</span> <span class="s">MONGO_INITDB_ROOT_PASSWORD=${DB_PASS:-whishper}</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">--logpath'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">/var/log/mongodb/mongod.log'</span><span class="pi">]</span>

  <span class="na">translate</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">whisper-libretranslate</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">libretranslate/libretranslate:latest-cuda</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./whisper/libretranslate/data:/home/libretranslate/.local/share</span>
      <span class="pi">-</span> <span class="s">./whisper/libretranslate/cache:/home/libretranslate/.local/cache</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">LT_DISABLE_WEB_UI=True</span>
      <span class="pi">-</span> <span class="s">LT_LOAD_ONLY=${LT_LOAD_ONLY:-en,fr,es}</span>
      <span class="pi">-</span> <span class="s">LT_UPDATE_MODELS=True</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
            <span class="na">count</span><span class="pi">:</span> <span class="s">all</span>
            <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>

  <span class="na">whisper</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">whisper</span>
    <span class="na">pull_policy</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">pluja/whishper:latest-gpu</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./whisper/uploads:/app/uploads</span>
      <span class="pi">-</span> <span class="s">./whisper/logs:/var/log/whishper</span>
      <span class="pi">-</span> <span class="s">./whisper/models:/app/models</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.whisper.rule=Host(`whisper.local.example.com`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.whisper.entrypoints=https"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.whisper.tls=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.whisper.tls.certresolver=cloudflare"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.whisper.loadbalancer.server.port=80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.whisper.middlewares=default-headers@file"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mongo</span>
      <span class="pi">-</span> <span class="s">translate</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">PUBLIC_INTERNAL_API_HOST=${WHISHPER_HOST}</span>
      <span class="pi">-</span> <span class="s">PUBLIC_TRANSLATION_API_HOST=${WHISHPER_HOST}</span>
      <span class="pi">-</span> <span class="s">PUBLIC_API_HOST=${WHISHPER_HOST:-}</span>
      <span class="pi">-</span> <span class="s">PUBLIC_WHISHPER_PROFILE=gpu</span>
      <span class="pi">-</span> <span class="s">WHISPER_MODELS_DIR=/app/models</span>
      <span class="pi">-</span> <span class="s">UPLOAD_DIR=/app/uploads</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
            <span class="na">count</span><span class="pi">:</span> <span class="s">all</span>
            <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">traefik</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="kc">true</span>
</pre></table></code></div></div><h3 id="general-docker-compose-stack"><span class="me-2">General Docker Compose Stack</span><a href="#general-docker-compose-stack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This Docker compose stack does not use traefik and also exposes the port on the host for each service. If you don’t want to expose the port, comment that section out. If you want to use the stack with traefik and macvlan, see the <a href="#ai-stack-docker-compose">stack I used in the video</a></p><p>Before running this, you will need to create the network for Docker to use.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker network create ai-stack
</pre></table></code></div></div><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
</pre><td class="rouge-code"><pre><span class="na">services</span><span class="pi">:</span>

  <span class="na">ollama</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ollama/ollama:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">ollama</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">OLLAMA_KEEP_ALIVE=24h</span>
      <span class="pi">-</span> <span class="s">ENABLE_IMAGE_GENERATION=True</span>
      <span class="pi">-</span> <span class="s">COMFYUI_BASE_URL=http://stable-diffusion-webui:7860</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ai-stack</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./ollama:/root/.ollama</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">11434:11434"</span> <span class="c1"># Add this line to expose the port</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
              <span class="na">count</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>

  <span class="na">open-webui</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/open-webui/open-webui:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">open-webui</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ai-stack</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">OLLAMA_BASE_URL=http://ollama:11434'</span>
      <span class="pi">-</span> <span class="s">ENABLE_RAG_WEB_SEARCH=True</span>
      <span class="pi">-</span> <span class="s">RAG_WEB_SEARCH_ENGINE=searxng</span>
      <span class="pi">-</span> <span class="s">RAG_WEB_SEARCH_RESULT_COUNT=3</span>
      <span class="pi">-</span> <span class="s">RAG_WEB_SEARCH_CONCURRENT_REQUESTS=10</span>
      <span class="pi">-</span> <span class="s">SEARXNG_QUERY_URL=http://searxng:8080/search?q=&lt;query&gt;</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./open-webui:/app/backend/data</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ollama</span>
    <span class="na">extra_hosts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">host.docker.internal:host-gateway</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:8080"</span> <span class="c1"># Add this line to expose the port</span>

  <span class="na">searxng</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">searxng/searxng:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">searxng</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ai-stack</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./searxng:/etc/searxng</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ollama</span>
      <span class="pi">-</span> <span class="s">open-webui</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8081:8080"</span> <span class="c1"># Add this line to expose the port</span>

  <span class="na">stable-diffusion-download</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./stable-diffusion-webui-docker/services/download/</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">comfy-download</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./stable-diffusion-webui-docker/data:/data</span>

  <span class="na">stable-diffusion-webui</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./stable-diffusion-webui-docker/services/comfy/</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">comfy-ui</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">CLI_ARGS=</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./stable-diffusion-webui-docker/data:/data</span>
      <span class="pi">-</span> <span class="s">./stable-diffusion-webui-docker/output:/output</span>
    <span class="na">stop_signal</span><span class="pi">:</span> <span class="s">SIGKILL</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
              <span class="na">device_ids</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">0'</span><span class="pi">]</span>
              <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">compute</span><span class="pi">,</span> <span class="nv">utility</span><span class="pi">]</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ai-stack</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">7860:7860"</span> <span class="c1"># Add this line to expose the port</span>

  <span class="na">mongo</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mongo</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ai-stack</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./whisper/db_data:/data/db</span>
      <span class="pi">-</span> <span class="s">./whisper/db_data/logs/:/var/log/mongodb/</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">MONGO_INITDB_ROOT_USERNAME=${DB_USER:-whishper}</span>
      <span class="pi">-</span> <span class="s">MONGO_INITDB_ROOT_PASSWORD=${DB_PASS:-whishper}</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">--logpath'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">/var/log/mongodb/mongod.log'</span><span class="pi">]</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">27017:27017"</span> <span class="c1"># Add this line to expose the port</span>

  <span class="na">translate</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">whisper-libretranslate</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">libretranslate/libretranslate:latest-cuda</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ai-stack</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./whisper/libretranslate/data:/home/libretranslate/.local/share</span>
      <span class="pi">-</span> <span class="s">./whisper/libretranslate/cache:/home/libretranslate/.local/cache</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">LT_DISABLE_WEB_UI=True</span>
      <span class="pi">-</span> <span class="s">LT_LOAD_ONLY=${LT_LOAD_ONLY:-en,fr,es}</span>
      <span class="pi">-</span> <span class="s">LT_UPDATE_MODELS=True</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
            <span class="na">count</span><span class="pi">:</span> <span class="s">all</span>
            <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5000:5000"</span> <span class="c1"># Add this line to expose the port</span>

  <span class="na">whisper</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">whisper</span>
    <span class="na">pull_policy</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">pluja/whishper:latest-gpu</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ai-stack</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./whisper/uploads:/app/uploads</span>
      <span class="pi">-</span> <span class="s">./whisper/logs:/var/log/whishper</span>
      <span class="pi">-</span> <span class="s">./whisper/models:/app/models</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mongo</span>
      <span class="pi">-</span> <span class="s">translate</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">PUBLIC_INTERNAL_API_HOST=${WHISHPER_HOST}</span>
      <span class="pi">-</span> <span class="s">PUBLIC_TRANSLATION_API_HOST=${WHISHPER_HOST}</span>
      <span class="pi">-</span> <span class="s">PUBLIC_API_HOST=${WHISHPER_HOST:-}</span>
      <span class="pi">-</span> <span class="s">PUBLIC_WHISHPER_PROFILE=gpu</span>
      <span class="pi">-</span> <span class="s">WHISPER_MODELS_DIR=/app/models</span>
      <span class="pi">-</span> <span class="s">UPLOAD_DIR=/app/uploads</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
            <span class="na">count</span><span class="pi">:</span> <span class="s">all</span>
            <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8000:80"</span> <span class="c1"># Add this line to expose the port</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">ai-stack</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="kc">true</span>
</pre></table></code></div></div><h2 id="changes-for-comfyui"><span class="me-2">Changes for ComfyUI</span><a href="#changes-for-comfyui" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Before starting the stack, in the room <code class="language-plaintext highlighter-rouge">ai-stack</code> folder, you’ll want to clone the repo (or just copy the necessary files).</p><p>(this will create the folder for you)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>git clone https://github.com/AbdBarho/stable-diffusion-webui-docker.git
</pre></table></code></div></div><p>After cloning, you’ll want to make a change to the Docker file</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nano stable-diffusion-webui-docker/services/comfy/Dockerfile
</pre></table></code></div></div><p>I commented out the pinning to commit hash and just grabbed the latest comfy.</p><div class="language-Dockerfile highlighter-rouge"><div class="code-header"> <span data-label-text="Dockerfile"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> pytorch/pytorch:2.3.0-cuda12.1-cudnn8-runtime</span>

<span class="k">ENV</span><span class="s"> DEBIAN_FRONTEND=noninteractive PIP_PREFER_BINARY=1</span>

<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> git <span class="o">&amp;&amp;</span> apt-get clean

<span class="k">ENV</span><span class="s"> ROOT=/stable-diffusion</span>
<span class="k">RUN </span><span class="nt">--mount</span><span class="o">=</span><span class="nb">type</span><span class="o">=</span>cache,target<span class="o">=</span>/root/.cache/pip <span class="se">\
</span>  git clone https://github.com/comfyanonymous/ComfyUI.git <span class="k">${</span><span class="nv">ROOT</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>  <span class="nb">cd</span> <span class="k">${</span><span class="nv">ROOT</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span>  git checkout master <span class="o">&amp;&amp;</span> <span class="se">\
</span><span class="c">#  git reset --hard 276f8fce9f5a80b500947fb5745a4dde9e84622d &amp;&amp; </span><span class="se">\
</span>  pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt

<span class="k">WORKDIR</span><span class="s"> ${ROOT}</span>
<span class="k">COPY</span><span class="s"> . /docker/</span>
<span class="k">RUN </span><span class="nb">chmod </span>u+x /docker/entrypoint.sh <span class="o">&amp;&amp;</span> <span class="nb">cp</span> /docker/extra_model_paths.yaml <span class="k">${</span><span class="nv">ROOT</span><span class="k">}</span>

<span class="k">ENV</span><span class="s"> NVIDIA_VISIBLE_DEVICES=all PYTHONPATH="${PYTHONPATH}:${PWD}" CLI_ARGS=""</span>
<span class="k">EXPOSE</span><span class="s"> 7860</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["/docker/entrypoint.sh"]</span>
<span class="k">CMD</span><span class="s"> python -u main.py --listen --port 7860 ${CLI_ARGS}</span>
</pre></table></code></div></div><p>If you cloned the repo and want to verify your changes, you can do so with:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>git diff
</pre></table></code></div></div><p>You should see something like</p><div class="language-diff highlighter-rouge"><div class="code-header"> <span data-label-text="Diff"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="gh">diff --git a/services/comfy/Dockerfile b/services/comfy/Dockerfile
index 2de504d..a84c8ce 100644
</span><span class="gd">--- a/services/comfy/Dockerfile
</span><span class="gi">+++ b/services/comfy/Dockerfile
</span><span class="p">@@ -9,7 +9,7 @@</span> RUN --mount=type=cache,target=/root/.cache/pip \
   git clone https://github.com/comfyanonymous/ComfyUI.git ${ROOT} &amp;&amp; \
   cd ${ROOT} &amp;&amp; \
   git checkout master &amp;&amp; \
<span class="gd">-  git reset --hard 276f8fce9f5a80b500947fb5745a4dde9e84622d &amp;&amp; \
</span><span class="gi">+#  git reset --hard 276f8fce9f5a80b500947fb5745a4dde9e84622d &amp;&amp; \
</span>   pip install -r requirements.txt
<span class="err">
</span> WORKDIR ${ROOT}
(END)
</pre></table></code></div></div><h2 id="downloading-models"><span class="me-2">Downloading Models</span><a href="#downloading-models" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You’ll want to grab any models you like from <a href="https://huggingface.co">HuggingFace</a>. I am using <a href="https://huggingface.co/stabilityai/stable-diffusion-3-medium">stabilityai/stable-diffusion-3-medium</a></p><p>You’ll want to download all of the models and then transfer them to your server and put them in the appropriate folders</p><p>Models will need to bt placed in the <code class="language-plaintext highlighter-rouge">Stable-diffusion</code> folder.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>stable-diffusion-webui-docker/data/models/Stable-diffusion
</pre></table></code></div></div><p>Models are any file in the root of <code class="language-plaintext highlighter-rouge">stable-diffusion-3-medium</code> that have the extension <code class="language-plaintext highlighter-rouge">*.safetensors</code></p><p>For clips, you’ll need to create this folder (because it doesn’t exist)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>stable-diffusion-webui-docker/data/models/CLIPEncoder
</pre></table></code></div></div><p>In there you’ll place your clips, from the <code class="language-plaintext highlighter-rouge">text_encoders</code> folder from <code class="language-plaintext highlighter-rouge">stable-diffusion-3-medium</code></p><h2 id="example-workflows-for-comfyui-and-stable-diffusion-3-medium"><span class="me-2">Example Workflows for ComfyUI and Stable Diffusion 3 Medium</span><a href="#example-workflows-for-comfyui-and-stable-diffusion-3-medium" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You’ll need to download the same workflows to the machine that accesses ComfyUI so you can import them into the browser.</p><p>Example workflows are also available on HuggingFace in the <a href="https://huggingface.co/stabilityai/stable-diffusion-3-medium/tree/main/comfy_example_workflows">Stable Diffusion 3 Medium repo</a></p><h2 id="verifying-models"><span class="me-2">Verifying Models</span><a href="#verifying-models" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you’re going to spend all of that time downloading these model files, you should also pend a few minutes verifying them. I typically do this once they are on the server running the AI Stack</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>shasum <span class="nt">-a</span> 256 ./sd3_medium.safetensors
</pre></table></code></div></div><p>This should output something like:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cc236278d28c8c3eccb8e21ee0a67ebed7dd6e9ce40aa9de914fa34e8282f191  ./sd3_medium.safetensors
</pre></table></code></div></div><p>You’ll want to be sure the checksum matches the checksum from the source (<a href="https://huggingface.co/stabilityai/stable-diffusion-3-medium/blob/main/sd3_medium.safetensors">HuggingFace</a>, etc).</p><h2 id="home-assistant-stack-docker-compose"><span class="me-2">Home Assistant Stack (Docker Compose)</span><a href="#home-assistant-stack-docker-compose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Please see <a href="#folder-structure">folder structure</a> above</p><p>Before running this, you will need to create the network for Docker to use.</p><p>This might already exist if you are using traefik. If so skip this step.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker network create traefik
</pre></table></code></div></div><p>This will create the <code class="language-plaintext highlighter-rouge">macvlan</code> network. Adjust accordingly.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>docker network create <span class="nt">-d</span> macvlan <span class="se">\</span>
<span class="nt">--subnet</span><span class="o">=</span>192.168.20.0/24 <span class="se">\</span>
<span class="nt">--gateway</span><span class="o">=</span>192.168.20.1 <span class="se">\</span>
<span class="nt">-o</span> <span class="nv">parent</span><span class="o">=</span>eth1 <span class="se">\</span>
iot_macvlan
</pre></table></code></div></div><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre><td class="rouge-code"><pre><span class="nn">---</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">homeassistant</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">homeassistant</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">iot_macvlan</span><span class="pi">:</span>
        <span class="na">ipv4_address</span><span class="pi">:</span> <span class="s">192.168.20.202</span> <span class="c1">#optional, I am using mac vlan, if you don't want to, remove iot_macvlan and don't create the network above</span>
      <span class="na">traefik</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/home-assistant/home-assistant:stable</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">faster-whisper-gpu</span>
      <span class="pi">-</span> <span class="s">wyoming-piper</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./home-assistant/config:/config</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.homeassistant.rule=Host(`homeassistant.local.example.com`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.homeassistant.entrypoints=https"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.homeassistant.tls=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.homeassistant.tls.certresolver=cloudflare"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.homeassistant.middlewares=default-headers@file"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.homeassistant.loadbalancer.server.port=8123"</span>

  <span class="na">faster-whisper-gpu</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">lscr.io/linuxserver/faster-whisper:gpu</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">faster-whisper-gpu</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
      <span class="pi">-</span> <span class="s">WHISPER_MODEL=tiny-int8</span>
      <span class="pi">-</span> <span class="s">WHISPER_BEAM=1</span> <span class="c1">#optional</span>
      <span class="pi">-</span> <span class="s">WHISPER_LANG=en</span> <span class="c1">#optional</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./faster-whisper/data:/config</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
              <span class="na">count</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>
  <span class="na">wyoming-piper</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">wyoming-piper</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">rhasspy/wyoming-piper</span> <span class="c1"># no gpu</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/etc/localtime:/etc/localtime:ro</span>
      <span class="pi">-</span> <span class="s">/etc/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">./wyoming-piper/data:/data</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PUID=${PUID:-1000}</span>
      <span class="pi">-</span> <span class="s">PGID=${PGID:-1000}</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">--voice en_US-lessac-medium</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">devices</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">driver</span><span class="pi">:</span> <span class="s">nvidia</span>
              <span class="na">count</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">capabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">gpu</span><span class="pi">]</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">traefik</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">iot_macvlan</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="kc">true</span>
</pre></table></code></div></div><h2 id="code-completion-vscode"><span class="me-2">Code Completion (VSCode)</span><a href="#code-completion-vscode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I am using Basic Auth Middleware with traefik. Please see <a href="#traefik">traefik section</a> for details on how to set this up.</p><h3 id="extension"><span class="me-2">Extension</span><a href="#extension" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>I am using <a href="https://www.continue.dev/">Continue</a> for code completion and integrated chat.</p><p>Example config.</p><p>If you aren’t going to use auth, remove the <code class="language-plaintext highlighter-rouge">requestOptions</code> key.</p><p>If you are going to use auth, please replace the <code class="language-plaintext highlighter-rouge">xxx</code> with the value from <a href="#basic-auth-hash">above</a></p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"models"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> 
      </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ollama (Self-Hosted)"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ollama"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AUTODETECT"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"completionOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="nl">"apiBase"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://ollama.local.example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"requestOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Basic xxx"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w"> 
  </span><span class="nl">"tabAutocompleteModel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Starcoder 3b"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ollama"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"starcoder2:3b"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"apiBase"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://ollama.local.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"requestOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Basic xxx"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h2 id="join-the-conversation"><span class="me-2">Join the conversation</span><a href="#join-the-conversation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><blockquote class="twitter-tweet" data-dnt="true" data-theme="dark"><p lang="en" dir="ltr">You know that video on self-hosted AI that I just released? <br /><br />Well I just followed up with one of the most in-depth tutorials I have ever released.<br /><br />FULL TUTORIAL HERE👇<a href="https://t.co/5JAo9Phd1Y">https://t.co/5JAo9Phd1Y</a> <a href="https://t.co/zdqgd0IgS8">pic.twitter.com/zdqgd0IgS8</a></p>&mdash; Techno Tim (@TechnoTimLive) <a href="https://twitter.com/TechnoTimLive/status/1810415330550063300?ref_src=twsrc%5Etfw">July 8, 2024</a></blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><h2 id="links"><span class="me-2">Links</span><a href="#links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>🛍️ Check out the new Merch Shop at <a href="https://l.technotim.live/shop">https://l.technotim.live/shop</a></p><p>⚙️ See all the hardware I recommend at <a href="https://l.technotim.live/gear">https://l.technotim.live/gear</a></p><p>🚀 Don’t forget to check out the <a href="https://l.technotim.live/quick-start">🚀Launchpad repo</a> with all of the quick start source files</p><p>🤝 Support me and <a href="/sponsor">help keep this site ad-free!</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/homelab/">homelab</a>, <a href="/categories/self-hosted/">self-hosted</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ai/" class="post-tag no-text-decoration" >ai</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/software/" class="post-tag no-text-decoration" >software</a> <a href="/tags/llm/" class="post-tag no-text-decoration" >llm</a> <a href="/tags/ollama/" class="post-tag no-text-decoration" >ollama</a> <a href="/tags/whisper/" class="post-tag no-text-decoration" >whisper</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How%20to%20Self-Host%20Your%20Own%20Private%20AI%20Stack%20-%20Techno%20Tim&url=https%3A%2F%2Ftechnotim.live%2Fposts%2Fai-stack-tutorial%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How%20to%20Self-Host%20Your%20Own%20Private%20AI%20Stack%20-%20Techno%20Tim&u=https%3A%2F%2Ftechnotim.live%2Fposts%2Fai-stack-tutorial%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ftechnotim.live%2Fposts%2Fai-stack-tutorial%2F&text=How%20to%20Self-Host%20Your%20Own%20Private%20AI%20Stack%20-%20Techno%20Tim" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Ftechnotim.live%2Fposts%2Fai-stack-tutorial%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <script defer type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/share-to-mastodon/+esm"></script> <button class="btn text-start" data-bs-toggle="tooltip" data-bs-placement="top" title="Mastodon" aria-label="Mastodon"> <share-to-mastodon class="share-mastodon" message="How%20to%20Self-Host%20Your%20Own%20Private%20AI%20Stack%20-%20Techno%20Tim" url="https%3A%2F%2Ftechnotim.live%2Fposts%2Fai-stack-tutorial%2F"customInstanceList="[{&quot;label&quot;:&quot;mastodon.social&quot;,&quot;link&quot;:&quot;https://mastodon.social/&quot;},{&quot;label&quot;:&quot;mastodon.online&quot;,&quot;link&quot;:&quot;https://mastodon.online/&quot;},{&quot;label&quot;:&quot;fosstodon.org&quot;,&quot;link&quot;:&quot;https://fosstodon.org/&quot;},{&quot;label&quot;:&quot;photog.social&quot;,&quot;link&quot;:&quot;https://photog.social/&quot;}]" > <i class="fa-fw fa-brands fa-mastodon"></i> </share-to-mastodon> </button> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/traefik-3-docker-certificates/">Traefik 3 and FREE Wildcard Certificates with Docker</a><li class="text-truncate lh-lg"> <a href="/posts/traefik-portainer-ssl/">Put Wildcard Certificates and SSL on EVERYTHING</a><li class="text-truncate lh-lg"> <a href="/posts/authelia-traefik/">2 Factor Auth and Single Sign on with Authelia</a><li class="text-truncate lh-lg"> <a href="/posts/grafana-loki/">Meet Grafana LOKI, a Log Aggregation System for Everything</a><li class="text-truncate lh-lg"> <a href="/posts/jekyll-docs-site/">Meet Jekyll - The Static Site Generator</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/homelab/">homelab</a> <a class="post-tag btn btn-outline-primary" href="/tags/hardware/">hardware</a> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/docker/">docker</a> <a class="post-tag btn btn-outline-primary" href="/tags/rancher/">rancher</a> <a class="post-tag btn btn-outline-primary" href="/tags/self-hosted/">self-hosted</a> <a class="post-tag btn btn-outline-primary" href="/tags/proxmox/">proxmox</a> <a class="post-tag btn btn-outline-primary" href="/tags/portainer/">portainer</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux/">linux</a> <a class="post-tag btn btn-outline-primary" href="/tags/k3s/">k3s</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/private-practical-local-ai/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1720184400" data-df="ll" > Jul 5, 2024 </time><h4 class="pt-0 my-2">Self-Hosted AI That's Actually Useful</h4><div class="text-muted"><p> I built a private, local, and self-hosted AI stack to help me out with daily tasks. 📺 Watch Video Disclosures Thanks to Surfshark Sponsoring this Video! Secure your privacy with Surfshark!...</p></div></div></a></article><article class="col"> <a href="/posts/change-detection-docker/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1718974800" data-df="ll" > Jun 21, 2024 </time><h4 class="pt-0 my-2">Track Changes Online with ChangeDetection, a Self-Hosted Docker Container!</h4><div class="text-muted"><p> Tracking things on the web just got a whole lot easier with ChangeDetection, the free and open source Docker container! Track website changes, price changes of products, and even track out of stoc...</p></div></div></a></article><article class="col"> <a href="/posts/portainer-update/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1613743200" data-df="ll" > Feb 19, 2021 </time><h4 class="pt-0 my-2">How to Update Portainer Fast, Simple, and Easy Guide</h4><div class="text-muted"><p> Updating Portainer is easy, if you know how.In this quick no fluff video, I will show you how to update any version of Portainer.This guide can be used for installing it too.Portainer is a containe...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/private-practical-local-ai/" class="btn btn-outline-primary" aria-label="Older" ><p>Self-Hosted AI That's Actually Useful</p></a> <a href="/posts/mini-rack-homelab-stack/" class="btn btn-outline-primary" aria-label="Newer" ><p>Mini Rack, HomeLab Stack</p></a></nav><script type="text/javascript"> (function () { const origin = 'https://giscus.app'; const iframe = 'iframe.giscus-frame'; const lightTheme = 'light'; const darkTheme = 'dark_dimmed'; let initTheme = lightTheme; const html = document.documentElement; if ( (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') || (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches) ) { initTheme = darkTheme; } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'timothystewart6/techno-tim.github.io', 'data-repo-id': 'MDEwOlJlcG9zaXRvcnkyNTQ3ODQ3Nzk', 'data-category': 'Comments', 'data-category-id': 'DIC_kwDODy-1C84CSN7z', 'data-mapping': 'pathname', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': 'en', 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusScript = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value) ); document.getElementById('tail-wrapper').appendChild(giscusScript); addEventListener('message', (event) => { if ( event.source === window && event.data && event.data.direction === ModeToggle.ID ) { /* global theme mode changed */ const mode = event.data.message; const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme; const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); })(); </script><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://l.technotim.live/twitter">Techno Tim</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p><a href="/sponsor/">🤝 Help keep this ad-free!</href> &nbsp; &nbsp;<a href="https://l.technotim.live/shop">🛍️ Check out the new merch shop!</href></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/homelab/">homelab</a> <a class="post-tag btn btn-outline-primary" href="/tags/hardware/">hardware</a> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/docker/">docker</a> <a class="post-tag btn btn-outline-primary" href="/tags/rancher/">rancher</a> <a class="post-tag btn btn-outline-primary" href="/tags/self-hosted/">self-hosted</a> <a class="post-tag btn btn-outline-primary" href="/tags/proxmox/">proxmox</a> <a class="post-tag btn btn-outline-primary" href="/tags/portainer/">portainer</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux/">linux</a> <a class="post-tag btn btn-outline-primary" href="/tags/k3s/">k3s</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
